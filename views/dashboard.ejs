<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Customer Manager</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f4f6f9;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    table th,
    table td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: left;
    }

    table th {
      background: #f0f0f0;
    }

    .btn {
      padding: 10px 15px;
      margin: 5px;
      border: none;
      cursor: pointer;
      border-radius: 5px;
    }

    .btn-primary {
      background: #007bff;
      color: white;
    }

    .btn-danger {
      background: #dc3545;
      color: white;
    }

    .error {
      padding: 20px;
      margin: 20px auto;
      background-color: #f44d5d;
      color: #f0f0f0;
      text-align: center;
    }

    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
    }

    .overlay-content {
      background: white;
      padding: 20px;
      /* width: 400px; */
      border-radius: 8px;
      position: relative;
    }

    .overlay-content h2 {
      margin-top: 0;
    }

    .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
      font-weight: bold;
      font-size: 18px;
    }

    .form-section {
      display: flex;
      flex-direction: column;
      margin-bottom: 15px;
    }

    .customer-block {
      display: flex;
      gap: 12px;
    }

    input {
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .hidden {
      display: none;
    }
  </style>
</head>

<body>
  <div class="error hidden"></div>
  <h1>Customer List</h1>

  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Date of Birth</th>
      </tr>
    </thead>
    <tbody class="table-body">
      <% if (customers && customers.length> 0) { %>
        <% customers.forEach(c=> { %>
          <tr class="c-cntn" data-id="<%= c._id.toString() %>">
            <td>
              <%= c.name %>
            </td>
            <td>
              <%= c.email %>
            </td>
            <td>
              <%= c.dateOfBirth.toLocaleDateString('en-GB', { day: '2-digit' , month: 'short' , year: 'numeric' }) %>
            </td>
            <td>
              <button class="delete-btn">
                x
              </button>
            </td>
          </tr>
          <% }) %>
            <% } else { %>
              <tr class="no-customer">
                <td colspan="3">No customers yet</td>
              </tr>
              <% } %>
    </tbody>
  </table>

  <button class="btn btn-primary" onclick="openOverlay()">Add Customer</button>

  <!-- Overlay -->
  <div class="overlay" id="overlay">
    <div class="overlay-content">
      <span class="close-btn" onclick="closeOverlay()">Ã—</span>
      <h2 id="formTitle">Add Customer</h2>

      <!-- Manual Form -->
      <form id="customerForm">
        <div id="manualInputs">
          <div class="customer-block">
            <div class="form-section">
              <label>Name</label>
              <input type="text" class="name" name="name" required>
            </div>
            <div class="form-section">
              <label>Email</label>
              <input type="email" class="email" name="email" required>
            </div>
            <div class="form-section">
              <label>Date of Birth</label>
              <input type="date" class="dob" name="dob" required>
            </div>
          </div>
        </div>

        <button type="button" class="btn btn-primary" onclick="addMore()">+ Add More</button>
        <button type="submit" class="btn btn-primary">Submit</button>
        <button type="button" class="btn" onclick="switchToCSV()">Upload CSV</button>
      </form>

      <!-- CSV Upload -->
      <form id="csvForm" class="hidden">
        <div class="form-section">
          <label>Upload CSV</label>
          <input type="file" name="file" class="file" accept=".csv" required>
        </div>
        <button type="submit" class="btn btn-primary">Submit CSV</button>
        <button type="button" class="btn btn-danger" onclick="backToForm()">Back</button>
      </form>
    </div>
  </div>
  
  <script>
    window.env = {
      BACKEND_URL: "<%= process.env.BACKEND_URL || 'http://localhost:9000' %>",
      NODE_ENV: "<%= process.env.NODE_ENV || 'development' %>"
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="./index.js"></script>
</body>

</html>